<!-- Loading State -->
<app-loading-state
  *ngIf="loading"
  message="Loading company details...">
</app-loading-state>

<!-- Error State -->
<app-error-state
  *ngIf="error && !loading"
  [error]="error"
  backButtonText="Back to Companies"
  (goBack)="goBack()">
</app-error-state>

<!-- Main Content -->
<div *ngIf="company && !loading" class="min-h-screen bg-gray-50">
  <!-- Context Breadcrumb -->
  <app-context-breadcrumb
    [context]="context"
    [companyName]="company.name"
    (navigateToContext)="onNavigateToContext($event)"
    (backToOverview)="onBackToOverview()">
  </app-context-breadcrumb>

  <!-- Header -->
  <app-company-header
    [company]="company"
    (goBack)="goBack()"
    (editCompany)="openEditModal()">
    (exportToPDF)="exportToPDF()">
  </app-company-header>

  <!-- Tabs Navigation -->
  <app-tabs-navigation
    [activeTab]="activeTab"
    [metricGroupTabs]="metricGroupTabs"
    [showAllMetricsTab]="true"
    (tabChange)="setActiveTab($event)">
  </app-tabs-navigation>

  <!-- Tab Content -->
  <div class="max-w-7xl mx-auto px-6 py-8">
    <!-- Overview Tab -->
    <app-overview-tab
      *ngIf="activeTab === 'overview'"
      [company]="company">
    </app-overview-tab>

    <!-- Assessment Tab -->
    <app-assessment-tab
      *ngIf="activeTab === 'assessment'"
      [company]="company">
    </app-assessment-tab>

    <!-- SWOT Analysis Tab -->
    <app-swot-tab
      *ngIf="activeTab === 'swot'"
      [company]="company">
    </app-swot-tab>

    <!-- GPS Targets Tab -->
    <app-gps-targets-tab
      *ngIf="activeTab === 'gps-targets'"
      [company]="company">
    </app-gps-targets-tab>

    <!-- Strategy Tab -->
    <app-strategy-tab
      *ngIf="activeTab === 'strategy'"
      [company]="company">
    </app-strategy-tab>

    <!-- Financial Tab -->
    <app-financial-tab
      *ngIf="activeTab === 'financial'"
      [company]="company">
    </app-financial-tab>

    <!-- Aggregate Metrics (All groups) Tab -->
    <app-financial-v2-tab
      *ngIf="activeTab === 'financial-v2'"
      [company]="company"
      [clientId]="getActiveClientId()"
      [programId]="getActiveProgramId()"
      [cohortId]="getActiveCohortId()"
    >
    </app-financial-v2-tab>

    <!-- Dynamic Metric Group Specific View (reuse financial-v2 component for now; it can filter internally later) -->
    <app-financial-v2-tab
      *ngIf="isMetricGroupTab(activeTab)"
      [company]="company"
      [clientId]="getActiveClientId()"
      [programId]="getActiveProgramId()"
      [cohortId]="getActiveCohortId()"
      [filterGroupId]="getActiveMetricGroupId()"
    ></app-financial-v2-tab>

    <!-- Purchases Tab -->
    <app-purchases-tab
      *ngIf="activeTab === 'purchases'"
      [company]="company">
    </app-purchases-tab>

    <!-- Compliance Tab -->
    <app-compliance-tab
      *ngIf="activeTab === 'compliance'"
      [company]="company">
    </app-compliance-tab>

    <!-- Documents Tab -->
    <app-documents-tab
      *ngIf="activeTab === 'documents'"
      [company]="company">
    </app-documents-tab>

    <!-- Tasks Tab -->
    <app-tasks-tab
      *ngIf="activeTab === 'tasks'"
      [company]="company">
    </app-tasks-tab>

    <!-- Growth Areas Tab -->
    <app-growth-areas-tab
      *ngIf="activeTab === 'growth'"
      [company]="company">
    </app-growth-areas-tab>

    <!-- Financial Targets Tab -->
    <app-financial-targets-tab
      *ngIf="activeTab === 'financial-targets'"
      [company]="company">
    </app-financial-targets-tab>

    <!-- HR Tracking Tab -->
    <app-hr-tracking-tab
      *ngIf="activeTab === 'hr-tracking'"
      [company]="company">
    </app-hr-tracking-tab>

    <!-- Sessions Tab -->
    <app-sessions-tab
      *ngIf="activeTab === 'sessions'"
      [company]="company">
    </app-sessions-tab>

    <!-- Executive Report Tab -->
    <!-- <app-executive-report
      *ngIf="activeTab === 'executive-report'"
      [company]="company">
    </app-executive-report> -->
  </div>
</div>

<!-- Company Edit Modal -->
<app-company-form-modal
  [isOpen]="isEditModalOpen"
  [editMode]="true"
  [company]="company"
  (close)="closeEditModal()"
  (companySaved)="onCompanySaved($event)">
</app-company-form-modal>
