<!-- Loading State -->
<app-loading-state
  *ngIf="loading"
  message="Loading company details...">
</app-loading-state>

<!-- Error State -->
<app-error-state
  *ngIf="error && !loading"
  [error]="error"
  backButtonText="Back to Companies"
  (goBack)="goBack()">
</app-error-state>

<!-- Main Content -->
<div *ngIf="company && !loading" class="min-h-screen bg-gray-50">
  <!-- Context Breadcrumb -->
  <app-context-breadcrumb
    [context]="context"
    [companyName]="company.name"
    (navigateToContext)="onNavigateToContext($event)"
    (backToOverview)="onBackToOverview()">
  </app-context-breadcrumb>

  <!-- Header -->
  <app-company-header
    [company]="company"
    (goBack)="goBack()"
    (editCompany)="openEditModal()">
    (exportToPDF)="exportToPDF()">
  </app-company-header>

  <!-- Tabs Navigation -->
  <app-tabs-navigation
    [activeTab]="activeTab"
    (tabChange)="setActiveTab($event)">
  </app-tabs-navigation>

  <!-- Tab Content -->
  <div class="max-w-7xl mx-auto px-6 py-8">
    <!-- Overview Tab -->
    <app-overview-tab
      *ngIf="activeTab === 'overview'"
      [company]="company">
    </app-overview-tab>

    <!-- Assessment Tab -->
    <div *ngIf="activeTab === 'assessment'">
      <!-- Assessment Tab Toggle and Migration Controls -->
      <div class="mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-sm font-medium text-yellow-800">Assessment Tab Testing</h3>
            <p class="text-xs text-yellow-700 mt-1">
              Testing new consolidated assessment approach. Switch between versions to compare.
            </p>
          </div>
          <div class="flex items-center space-x-3">
            <!-- Version Toggle -->
            <div class="flex items-center space-x-2">
              <label class="text-xs text-yellow-700">Version:</label>
              <select
                [(ngModel)]="assessmentVersion"
                class="text-xs border-yellow-300 rounded px-2 py-1 bg-white"
              >
                <option value="original">Original (Sections)</option>
                <option value="consolidated">Consolidated (New)</option>
              </select>
            </div>

            <!-- Migration Button -->
            <button
              *ngIf="assessmentVersion === 'consolidated'"
              (click)="migrateAssessmentData()"
              [disabled]="isMigrating"
              class="px-3 py-1 text-xs font-medium text-white bg-blue-600 border border-transparent rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"
            >
              {{ isMigrating ? 'Migrating...' : 'Migrate Data' }}
            </button>

            <!-- Migration Status -->
            <div *ngIf="migrationStatus" class="text-xs px-2 py-1 rounded"
                 [class]="getMigrationStatusClass()">
              {{ migrationStatus }}
            </div>
          </div>
        </div>
      </div>

      <!-- Original Assessment Component -->
      <app-assessment-tab
        *ngIf="assessmentVersion === 'original'"
        [company]="company">
      </app-assessment-tab>

      <!-- New Consolidated Assessment Component -->
      <app-assessment-tab-consolidated
        *ngIf="assessmentVersion === 'consolidated'"
        [company]="company"
        [showDebugInfo]="true">
      </app-assessment-tab-consolidated>
    </div>

    <!-- SWOT Analysis Tab -->
    <app-swot-tab
      *ngIf="activeTab === 'swot'"
      [company]="company">
    </app-swot-tab>

    <!-- GPS Targets Tab -->
    <app-gps-targets-tab
      *ngIf="activeTab === 'gps-targets'"
      [company]="company">
    </app-gps-targets-tab>

    <!-- Strategy Tab -->
    <app-strategy-tab
      *ngIf="activeTab === 'strategy'"
      [company]="company">
    </app-strategy-tab>

    <!-- Financial Tab -->
    <app-financial-tab
      *ngIf="activeTab === 'financial'"
      [company]="company">
    </app-financial-tab>

    <!-- Purchases Tab -->
    <app-purchases-tab
      *ngIf="activeTab === 'purchases'"
      [company]="company">
    </app-purchases-tab>

    <!-- Compliance Tab -->
    <app-compliance-tab
      *ngIf="activeTab === 'compliance'"
      [company]="company">
    </app-compliance-tab>

    <!-- Documents Tab -->
    <app-documents-tab
      *ngIf="activeTab === 'documents'"
      [company]="company">
    </app-documents-tab>

    <!-- Tasks Tab -->
    <app-tasks-tab
      *ngIf="activeTab === 'tasks'"
      [company]="company">
    </app-tasks-tab>

    <!-- Growth Areas Tab -->
    <app-growth-areas-tab
      *ngIf="activeTab === 'growth'"
      [company]="company">
    </app-growth-areas-tab>

    <!-- Financial Targets Tab -->
    <app-financial-targets-tab
      *ngIf="activeTab === 'financial-targets'"
      [company]="company">
    </app-financial-targets-tab>

    <!-- HR Tracking Tab -->
    <app-hr-tracking-tab
      *ngIf="activeTab === 'hr-tracking'"
      [company]="company">
    </app-hr-tracking-tab>
    <!-- Executive Report Tab -->
    <!-- <app-executive-report
      *ngIf="activeTab === 'executive-report'"
      [company]="company">
    </app-executive-report> -->
  </div>
</div>

<!-- Company Edit Modal -->
<app-company-form-modal
  [isOpen]="isEditModalOpen"
  [editMode]="true"
  [company]="company"
  (close)="closeEditModal()"
  (companySaved)="onCompanySaved($event)">
</app-company-form-modal>
