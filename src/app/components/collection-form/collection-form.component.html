<!-- Modal Backdrop -->
<div *ngIf="isVisible" 
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4"
     style="z-index: 9999;"
     (click)="onCancel()">
  
  <!-- Modal panel -->
  <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-screen overflow-y-auto"
       style="z-index: 10000;"
       (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="bg-white px-6 py-4 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-medium text-gray-900" id="modal-title">
          {{ existingCollection ? 'Edit Collection' : 'Create New Collection' }}
        </h3>
        <button type="button" 
                (click)="onCancel()"
                class="bg-white rounded-md text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
          <lucide-icon [img]="XIcon" class="h-6 w-6"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- Form Content -->
    <div class="bg-white px-6 py-4 max-h-96 overflow-y-auto">
      <form (ngSubmit)="onSave()" #collectionForm="ngForm">
        
        <!-- Basic Information Section -->
        <div class="mb-6">
          <h4 class="text-md font-medium text-gray-900 mb-4">Basic Information</h4>
          
          <div class="grid grid-cols-1 gap-4">
            <!-- Collection Name -->
            <div>
              <label for="collection-name" class="block text-sm font-medium text-gray-700 mb-1">
                Collection Name <span class="text-red-500">*</span>
              </label>
              <input type="text" 
                     id="collection-name"
                     [(ngModel)]="collectionName"
                     name="collectionName"
                     required
                     placeholder="e.g., Companies"
                     class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>
          </div>
        </div>

        <!-- Groups Section -->
        <app-group-manager 
          [(groups)]="groups"
          (groupsChange)="onGroupsChange($event)">
        </app-group-manager>

        <!-- Fields Section -->
        <app-field-manager 
          [(fields)]="fields"
          [availableGroups]="groups"
          (fieldsChange)="onFieldsChange($event)">
        </app-field-manager>

        <!-- Form Actions -->
        <div class="flex justify-end space-x-3 mt-6">
          <button type="button" 
                  (click)="onCancel()"
                  [disabled]="isLoading"
                  class="inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm disabled:cursor-not-allowed">
            Cancel
          </button>
          <button type="submit" 
                  [disabled]="!isFormValid() || collectionForm.invalid || isLoading"
                  class="inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm disabled:bg-gray-400 disabled:cursor-not-allowed">
            <lucide-icon *ngIf="isLoading" [img]="RotateCwIcon" class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"></lucide-icon>
            {{ isLoading ? 'Saving...' : (existingCollection ? 'Update Collection' : 'Create Collection') }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
